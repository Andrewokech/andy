<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Counter Dashboard</title>

    <link href="assets/css/pace.min.css" rel="stylesheet">
    <script src="assets/js/pace.min.js"></script>
    <link rel="icon" href="assets/images/andey.png" type="image/png">
    <link
      href="assets/plugins/vectormap/jquery-jvectormap-2.0.2.css"
      rel="stylesheet">
    <link href="assets/plugins/simplebar/css/simplebar.css" rel="stylesheet">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/animate.css" rel="stylesheet" type="text/css">
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="assets/css/sidebar-menu.css" rel="stylesheet">
    <link href="assets/css/app-style.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  </head>
  <body class="bg-theme bg-theme1">
    <div id="wrapper">
      <div
        id="sidebar-wrapper"
        data-simplebar=""
        data-simplebar-auto-hide="true"
      >
        <div class="brand-logo">
          <a href="index.html">
            <img
              src="assets/images/andey.png"
              class="logo-icon"
              alt="logo icon">
            <h5 class="logo-text">COUNTER DASHBOARD</h5>
          </a>
        </div>
        <ul class="sidebar-menu do-nicescrol">
          <li class="sidebar-header">MAIN COMPONENTS</li>
          <li>
            <a href="index.html">
              <i class="zmdi zmdi-home"></i> <span class="searchable">Dashboard</span>
            </a>
          </li>
          <li>
            <a href="history.html">
              <i class="zmdi zmdi-grid"></i> <span class="searchable">History</span>
            </a>
          </li>
        </ul>
      </div>
      <header class="topbar-nav">
        <nav class="navbar navbar-expand fixed-top">
          <ul class="navbar-nav mr-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link toggle-menu" href="javascript:void();">
                <i class="icon-menu menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <form class="search-bar">
                <input id="searchBar" type="text" class="form-control" placeholder="Search...">
                <a href="javascript:void();"><i class="icon-magnifier"></i></a>
            </form>
            </li>
          </ul>

          <ul class="navbar-nav mr-auto align-items-center">
            <!-- Download CSV button -->
            <li class="nav-item">
              <button id="downloadCSVButton" class="btn btn-primary" onclick="downloadAllChartsCSV()">Download CSV</button>

            </li>
            <!-- Your existing search form -->
          </ul>
        </nav>
      </header>
      <div class="clearfix"></div>

      <div class="content-wrapper searchable">
        <div class="container-fluid">
          <div class="card mt-3 searchable">
            <div class="card-content">
              <div class="row row-group m-0">
                <div class="col-12 col-lg-6 col-xl-3 border-light">
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <span id="totalEntries">Loading...</span>
                      <span class="float-right"
                        ><i class="fa fa-sign-in"></i
                      ></span>
                    </h5>
                    <div class="progress my-3" style="height: 3px">
                      <div class="progress-bar" style="width: 55%"></div>
                    </div>
                    <p class="mb-0 text-white small-font">
                      Total Daily Entries
                      <span class="float-right" id="totalEntriesChange">
                        <i class="zmdi zmdi-long-arrow-up"></i
                      ></span>
                    </p>
                  </div>
                </div>
                <div class="col-12 col-lg-6 col-xl-3 border-light">
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <span id="totalExits">Loading...</span>
                      <span class="float-right"
                        ><i class="fa fa-sign-out"></i
                      ></span>
                    </h5>
                    <div class="progress my-3" style="height: 3px">
                      <div class="progress-bar" style="width: 55%"></div>
                    </div>
                    <p class="mb-0 text-white small-font">
                      Total Daily Exit
                      <span class="float-right" id="totalExitsChange">
                        <i class="zmdi zmdi-long-arrow-down"></i
                      ></span>
                    </p>
                  </div>
                </div>
                <div class="col-12 col-lg-6 col-xl-3 border-light">
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <span id="entryRate">Loading...</span>
                      <span class="float-right"
                        ><i class="fa fa-percent"></i
                      ></span>
                    </h5>
                    <div class="progress my-3" style="height: 3px">
                      <div
                        id="entryProgressBar"
                        class="progress-bar"
                        style="width: 55%"
                      ></div>
                    </div>
                    <p class="mb-0 text-white small-font">
                      Entry Rate
                      <span class="float-right" id="entryRateChange">
                        <i class="zmdi zmdi-long-arrow-up"></i
                      ></span>
                    </p>
                  </div>
                </div>
                <div class="col-12 col-lg-6 col-xl-3 border-light">
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <span id="exitRate">Loading...</span>
                      <span class="float-right"
                        ><i class="fa fa-percent"></i
                      ></span>
                    </h5>
                    <div class="progress my-3" style="height: 3px">
                      <div
                        id="exitProgressBar"
                        class="progress-bar"
                        style="width: 55%"
                      ></div>
                    </div>
                    <p class="mb-0 text-white small-font">
                      Exit Rate
                      <span class="float-right" id="exitRateChange">
                        <i class="zmdi zmdi-long-arrow-down"></i
                      ></span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-12 col-lg-8 col-xl-8 searchable">
              <div class="card">
                <div class="card-header">
                  Object Count in Each Zone (2-Hour Intervals)
                  <div class="card-action">
                    <div class="dropdown">
                      <a
                        href="javascript:void();"
                        class="dropdown-toggle dropdown-toggle-nocaret"
                        data-toggle="dropdown"
                      >
                        <i class="icon-options"></i>
                      </a>
                      <div class="dropdown-menu dropdown-menu-right">
                        <a
                          class="dropdown-item"
                          href="javascript:void();"
                          onclick="downloadCSV('chart1')"
                          >Download CSV</a
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <ul class="list-inline">
                    <li class="list-inline-item">
                      <i
                        class="fas fa-dot-circle mr-2"
                        style="color: rgb(138, 109, 138, 0.5)"
                      ></i
                      >Dynamic Zone Activity Over Time
                    </li>
                  </ul>
                  <div class="chart-container-1">
                    <canvas id="chart1"></canvas>
                  </div>
                </div>
                <div
                  class="row m-0 row-group text-center border-top border-light-3"
                >
                  <div class="col-12 col-lg-4">
                    <div class="p-3">
                      <h5 class="mb-0"><span id="totalEntry">Loading...</span></h5>
                      <small class="mb-0">Total Entries</small>
                    </div>
                  </div>
                  <div class="col-12 col-lg-4">
                    <div class="p-3">
                      <h5 class="mb-0">
                        <span id="averageEntriesPerDay">Loading...</span>
                      </h5>
                      <small class="mb-0">Average Entries per Day</small>
                    </div>
                  </div>
                  <div class="col-12 col-lg-4">
                    <div class="p-3">
                      <h5 class="mb-0"><span id="peakHour">Loading...</span></h5>
                      <small class="mb-0">Peak Hour</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12 col-lg-4 col-xl-4 searchable">
              <div class="card">
                <div class="card-header">
                  Total Sum Count Of Object(Weekly)
                  <div class="card-action">
                    <div class="dropdown">
                      <a
                        href="javascript:void();"
                        class="dropdown-toggle dropdown-toggle-nocaret"
                        data-toggle="dropdown"
                      >
                        <i class="icon-options"></i>
                      </a>
                      <div class="dropdown-menu dropdown-menu-right">
                        <a
                          class="dropdown-item"
                          href="javascript:void();"
                          onclick="downloadCSV('chart2')"
                          >Download CSV</a
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div class="chart-container-2">
                    <canvas id="chart2"></canvas>
                  </div>
                </div>
                <div class="table-responsive">
                  <table class="table align-items-center">
                    <tbody>
                      <tr>
                        <td>
                          <i class="fa fa-circle" style="color: #cf1bb4"></i>
                          Object Z3
                        </td>
                        <td></td>
                        <td><span class=""></span></td>
                      </tr>
                      <tr>
                        <td>
                          <i class="fa fa-circle" style="color: #8c25fa"></i>
                          Object Z4
                        </td>
                        <td></td>
                        <td><span class=""></span></td>
                      </tr>
                      <tr>
                        <td>
                          <i class="fa fa-circle" style="color: #ffce56"></i>
                          Object Z5
                        </td>
                        <td></td>
                        <td><span class=""></span></td>
                      </tr>
                      <tr>
                        <td>
                          <i class="fa fa-circle" style="color: #4caf50"></i>
                          Object Z6
                        </td>
                        <td></td>
                        <td><span class=""></span></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12 col-lg-12 searchable">
              <div class="card">
                <div class="card-header">
                  Daily Entry and Exit Count
                  <div class="card-action">
                    <div class="dropdown">
                      <a
                        href="javascript:void();"
                        class="dropdown-toggle dropdown-toggle-nocaret"
                        data-toggle="dropdown"
                      >
                        <i class="icon-options"></i>
                      </a>
                      <div class="dropdown-menu dropdown-menu-right">
                        <a
                            class="dropdown-item"
                            href="javascript:void();"
                            onclick="downloadCSV('dataTable')"
                        >Download CSV</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="table-responsive">
                  <table
                    class="table align-items-center table-flush table-borderless"
                  >
                    <thead>
                      <tr>
                        <th>Zone</th>
                        <th>Entry Count</th>
                        <th>Exit Count</th>
                        <th>Total Count</th>
                        <th>Date</th>
                        <th>Progress</th>
                      </tr>
                    </thead>
                    <tbody id="dataTable">
                      <!-- Rows will be populated by JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="overlay toggle-menu"></div>
        </div>
      </div>
      <a href="javaScript:void();" class="back-to-top"
        ><i class="fa fa-angle-double-up"></i>
      </a>
      <footer class="footer">
        <div class="container">
          <div class="text-center">Copyright © 2024 Counter Dashboard</div>
        </div>
      </footer>
    </div>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/plugins/simplebar/js/simplebar.js"></script>
    <script src="assets/js/sidebar-menu.js"></script>
    <script src="assets/js/jquery.loading-indicator.js"></script>
    <script src="assets/js/app-script.js"></script>
    <script src="assets/plugins/Chart.js/Chart.min.js"></script>
    <script src="assets/js/script.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    

    <script>
      function downloadAllChartsCSV() {
        let csvContent = "";
        csvContent += "Chart 1 - Object Count in Each Zone (2-Hour Intervals)\n";
        csvContent += "Time Frame,Zone 1,Zone 2,Zone 3,Zone 4,Zone 5\n";
        const timeFrames = window.myChart1.data.labels;
        const zoneData = window.myChart1.data.datasets.map((dataset) =>
           dataset.data
        );
        for (let i = 0; i < timeFrames.length; i++) {
          csvContent +=
            timeFrames[i] + "," + zoneData.map((zone) => zone[i]).join(",") + "\n";
        }
        const totalEntries1 = document.getElementById("totalEntry").textContent;
        const averageEntriesPerDay1 = document.getElementById("averageEntriesPerDay").textContent;
        const peakHour1 = document.getElementById("peakHour").textContent;
        csvContent += "\nTotal Entries," + totalEntries1 + "\n";
        csvContent += "Average Entries per Day," + averageEntriesPerDay1 + "\n";
        csvContent += "Peak Hour," + peakHour1 + "\n";

        csvContent += "\nChart 2 - Total Sum Count Of Object(Weekly)\n";
        csvContent += "Object,Data\n";
        const chartData = window.myChart2.data.datasets[0].data;
        const objectLabels = window.myChart2.data.labels;
        for (let i = 0; i < chartData.length; i++) {
        csvContent += objectLabels[i] + "," + chartData[i] + "\n";
        }
        const tableContent = downloadCSVContent("dataTable");
          csvContent += tableContent;

         downloadCSV(csvContent);
       }

       function downloadCSVContent(dataTable) {
       const tableBody = document.getElementById(dataTable).querySelector("tbody");
       if (!tableBody || tableBody.children.length === 0) {
       console.error('Error: Table is empty.');
        return "";
      }

       let csvContent = "Daily Entry and Exit Count\n";
       csvContent += "Zone,Entry Count,Exit Count,Total Count,Date,Progress (%)\n";

      const rows = tableBody.querySelectorAll("tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        const rowData = Array.from(cells).map(cell => cell.textContent.trim());
        const progress = cells[5].querySelector(".progress-bar").style.width;
        const progressValue = parseFloat(progress.replace("%", ""));

         csvContent += `${rowData.join(',')},${progressValue}\n`;
      });

         return csvContent;
      }

      function downloadCSV(csvContent) {
        const encodedUri = encodeURI(csvContent);
        const blob = new Blob([csvContent], {
        type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", `chart_and_table_data.csv`);
        document.body.appendChild(link);
        link.click();
      }
      $(document).ready(function() {
            function highlightText(node, keyword) {
                if (node.nodeType === 3) { // Text node
                    const regex = new RegExp(`(${keyword})`, 'gi');
                    const text = node.nodeValue;
                    const replacedText = text.replace(regex, '<span class="highlight">$1</span>');
                    const newNode = document.createElement('span');
                    newNode.innerHTML = replacedText;
                    node.parentNode.insertBefore(newNode, node.nextSibling);
                    node.parentNode.removeChild(node);
                } else if (node.nodeType === 1 && node.childNodes && !/(script|style)/i.test(node.tagName)) { // Element node and not script/style tags
                    for (let i = 0; i < node.childNodes.length; i++) {
                        highlightText(node.childNodes[i], keyword);
                    }
                }
            }

            function removeHighlights(element) {
                element.find('.highlight').each(function() {
                    const text = this.textContent || this.innerText;
                    $(this).replaceWith(text);
                });
            }

            function updateHighlights(keyword) {
                $(".searchable").each(function() {
                    const element = $(this);
                    removeHighlights(element);
                    if (keyword.length > 0) { 
                        let part = '';
                        for (let i = 0; i < keyword.length; i++) {
                            part += keyword[i];
                            highlightText(this, part);
                        }
                    }
                });
            }

            $("#searchBar").on('input', function() {
                const inputVal = $(this).val().toLowerCase();
                updateHighlights(inputVal);
            });
        });
    </script>
    
  </body>
</html>
